# ACPI

> 参考：
>
> [Intel 支持高级配置和电源接口（ACPI）状态](https://edc.intel.com/content/www/us/en/design/ipla/software-development-platforms/client/platforms/alder-lake-desktop/12th-generation-intel-core-processors-datasheet-volume-1-of-2/002/advanced-configuration-and-power-interface-acpi-states-supported/)



ACPI（Advanced Configuration and Power Interface）为操作系统、应用程序提供了统一的电源管理接口标准。它包括软件和硬件两个方面的规范。是硬件设备与操作系统软件之间抽象标准。

## G0/C0/S0

日常工作模式

## G1

G1=S3/S4

S3：系统环境（内存中的数据或上下文）保存于内存中。外部时钟关闭，RTC时钟和内部环形振荡器时钟仍在切换。

S4：系统环境（内存中的数据或上下文）保存于硬盘中。除了恢复所需的逻辑外，所有电源都关闭了。外部显示与S5相同，但可能有不同的唤醒事件。

### Windows

> 在Windows中S4是休眠，并且广义的睡眠概念包含休眠（体现在eventvwr.msc中），但作为按钮动作时才会体现出区别。windows的电源管理，支持“睡眠、休眠、关机、重启”。其中睡眠便是S3,休眠便是S4。另外当BIOS支持休眠时，将会保存休眠文件到硬盘（休眠前仅包含核心进程的内存），若休眠文件所在的分区（通常是C盘）的空间容量不足，那么用户进程是无法保留的。
>
> 查看支持的睡眠模式
>
> ```
> powercfg /a
> ```
>
> 打开休眠，启动以后产生休眠文件（通常3G-6G）
>
> ```
> powercfg /h on
> ```
>
> 关闭休眠，关闭以后立即删除休眠文件
>
> ```
> powercfg /h off
> ```

### MacOS

> [Mac 上的安全睡眠是什么？](https://support.apple.com/zh-cn/guide/mac-help/mh10328/mac)
>
> Mac 笔记本电脑具有被称为*安全睡眠*的功能。使用安全睡眠，Mac 每次进入睡眠状态后，Mac 的当前状态（包括打开的 App 和打开的文稿）会存储。当睡眠期间 Mac 由于电池用完或被替换而完全关机时，安全睡眠可防止你的信息丢失。如果你的 Mac 需要在醒来时访问存储的状态，在你的 Mac 准备好使用之前会显示一个进程条。Mac的安全睡眠类似于Windows的休眠，但具体的动作取决于hibernatemode值。
>
> **1. 启动安全睡眠**
>
> 当hibernatemode=3时，系统会将内存副本存储到磁盘，并在睡眠期间为内存供电。系统将从内存中唤醒，除非电源耗尽这讲迫使系统从休眠产生的文件中恢复。
>
> 当hibernatemode=25时，只能通过`sudo pmset -a hibernatemode 25`命令进行设置。系统会将内存副本存储到磁盘，并将停止向内存供电，系统将从休眠产生的文件恢复。如果您想要航能力更长，您应该使用此设置。
>
> 其实hibernatemode还可以设置0，此时内存副本不会存储到硬盘中，系统必须将中内存中唤醒。历史上曾有几代的macbook是采用这种模式，后来均为hibernatemode=3。
>
> **2. 禁用安全睡眠**
>
> 这可能是MacPro的使用场景
>
> ```
> sudo pmset -a autopoweroff
> sudo pmset -a hibernatemode 0
> ```
>
> **3.睡眠后进入安全睡眠模式**
>
> ```
> # 启动硬盘睡眠
> sudo pmset -a disksleep 1
> # 睡眠后的10分钟进入安全睡眠
> sudo pmset -a autopoweroffdelay 10
> ```
>
> 



## G2/S5

除了能够唤醒主机的设备外，其他电源均关闭，需要重新引导。

## G3

机械关机，又称冷启动。当正在运行的主机突然断电，再恢复电源时的状态便是G3。此时绝大部分BIOS是无法设置网卡的寄存器，造成无法开机，但部分BIOS支持“Restore on AC power loss”（类似的英文，即断电恢复），通过该功能能让系统恢复到断电前的状态（或通电或已关机）。





## 其他状态

Gx (Global state, 整個系統) :

- G0 = Working state (C0~C3)
- G1 = Sleeping state (S2~S4)
- G2 = Soft off (S5)正常關機，電源還插著因此主機板還有standby power，可被外部如LAN喚醒開機
- G3 = 拔電源(Mechanical off)

Dx (Device state, 周邊設備) :

- D0 = 正常運作
- 耗電 D1 > D2
- D3 = 斷電

Sx (Sleeping state, 定義在G1 (sleeping)的睡覺層級) :

- S0 = 正常運作
- S1 = 等同CPU進入C3 state (一般有S3就不會進這個state)
- S2 (沒有使用)
- S3 = Suspend to RAM (資料留在DRAM並持續保留DRAM電源，周邊裝置如硬碟將會被斷電)
- S4 = Suspend to Disk (資料存到非揮發裝置(Disk)並將系統Soft off, 但系統需在復電後回復到斷電前的系統狀態，所以S4,S5是軟體的差別)
- S5 = Soft off (=G2)

Cx (CPU state)

- C0 = CPU正常運作
- C1 = CPU halt state
- C2 = CPU Clock stop
- C3 = CPU sleep state
