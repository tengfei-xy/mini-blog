# çº¿ç¨‹

## ç›®å½•

-   [åˆ›å»ºçº¿ç¨‹](#åˆ›å»ºçº¿ç¨‹)

# åˆ›å»ºçº¿ç¨‹

> ğŸ“Œ1. çº¿ç¨‹å†…éƒ¨çš„ä»£ç ä½¿ç”¨é—­åŒ…æ¥æ‰§è¡Œ
> 2\. `main` çº¿ç¨‹ä¸€æ—¦ç»“æŸï¼Œç¨‹åºå°±ç«‹åˆ»ç»“æŸï¼Œå› æ­¤éœ€è¦ä¿æŒå®ƒçš„å­˜æ´»ï¼Œç›´åˆ°å…¶å®ƒå­çº¿ç¨‹å®Œæˆè‡ªå·±çš„ä»»åŠ¡
> 3\. `thread::sleep` ä¼šè®©å½“å‰çº¿ç¨‹ä¼‘çœ æŒ‡å®šçš„æ—¶é—´ï¼Œéšåå…¶å®ƒçº¿ç¨‹ä¼šè¢«è°ƒåº¦è¿è¡Œï¼ˆä¸Šä¸€èŠ‚å¹¶å‘ä¸å¹¶è¡Œä¸­æœ‰ç®€å•ä»‹ç»è¿‡ï¼‰ï¼Œå› æ­¤å°±ç®—ä½ çš„ç”µè„‘åªæœ‰ä¸€ä¸ª CPU æ ¸å¿ƒï¼Œè¯¥ç¨‹åºä¹Ÿä¼šè¡¨ç°çš„å¦‚åŒå¤š CPU æ ¸å¿ƒä¸€èˆ¬ï¼Œè¿™å°±æ˜¯å¹¶å‘ï¼
> 4\. åƒä¸‡ä¸è¦ä¾èµ–çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚

-   ä¾‹ï¼šç­‰å¾…å­çº¿ç¨‹ç»“æŸ

    è¯´æ˜ï¼šé€šè¿‡è°ƒç”¨ `handle.join`ï¼Œå¯ä»¥è®©å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°å®ƒç­‰å¾…çš„å­çº¿ç¨‹çš„ç»“æŸï¼Œ
    ```rust
    use std::thread;
    use std::time::Duration;

    fn main() {
        let handle = thread::spawn(|| {
            for i in 1..5 {
                println!("hi number {} from the spawned thread!", i);
                thread::sleep(Duration::from_millis(1));
            }
        });

        handle.join().unwrap();

        for i in 1..5 {
            println!("hi number {} from the main thread!", i);
            thread::sleep(Duration::from_millis(1));
        }
    }
    ```

<!---->

-   ä¾‹ï¼šé™åˆ¶åˆ›å»ºçº¿ç¨‹æ•°

    è¯´æ˜ï¼šä»£ç è·Ÿä¹‹å‰çš„ç±»ä¼¼ï¼Œä¹Ÿéå¸¸ç®€æ´æ˜äº†ï¼Œ `ThreadPool::new(4)` åˆ›å»ºä¸€ä¸ªåŒ…å« 4 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ¥ç€é€šè¿‡ `pool.execute` å»åˆ†å‘æ‰§è¡Œè¯·æ±‚ã€‚
    ```rust
    fn main() {
        let listener = TcpListener::bind("127.0.0.1:7878").unwrap();
        let pool = ThreadPool::new(4);

        for stream in listener.incoming() {
            let stream = stream.unwrap();

            pool.execute(|| {
                handle_connection(stream);
            });
        }
    }
    ```
