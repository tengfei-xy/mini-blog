# CVE-2020-15778

## 目录

-   [描述](#描述)
-   [参考文献](#参考文献)
-   [问题复现](#问题复现)
-   [openssh供应商回应](#openssh供应商回应)
-   [解决方案](#解决方案)
-   [个人理解](#个人理解)

## 描述

\*\*OpenSSH到8.3p1中的[争议](https://cve.mitre.org/about/faqs.html#disputed_signify_in_cve_entry "争议")\*\*scp允许在scp.c toremote函数中注入命令，目标参数中的反勾字符所示。注：据报道，供应商表示，他们故意省略了对“异常参数传输”的验证，因为这“极有可能破坏现有工作流程”。

> 原文：\*\* [DISPUTED](https://cve.mitre.org/about/faqs.html#disputed_signify_in_cve_entry "DISPUTED") \*\* scp in OpenSSH through 8.3p1 allows command injection in the scp.c toremote function, as demonstrated by backtick characters in the destination argument. NOTE: the vendor reportedly has stated that they intentionally omit validation of "anomalous argument transfers" because that could "stand a great chance of breaking existing workflows."

## 参考文献

-   [CONFIRM:https://security.netapp.com/advisory/ntap-20200731-0007/](https://security.netapp.com/advisory/ntap-20200731-0007/ "CONFIRM:https://security.netapp.com/advisory/ntap-20200731-0007/")
-   [MISC:https://github.com/cpandya2909/CVE-2020-15778/](https://github.com/cpandya2909/CVE-2020-15778/ "MISC:https://github.com/cpandya2909/CVE-2020-15778/")
-   [MISC:https://news.ycombinator.com/item？id=25005567](https://news.ycombinator.com/item?id=25005567 "MISC:https://news.ycombinator.com/item？id=25005567")
-   [MISC:https://www.openssh.com/security.html](https://www.openssh.com/security.html "MISC:https://www.openssh.com/security.html")
-   漏洞行：[https://github.com/openssh/openssh-portable/blob/a2855c048b3f4b17d8787bd3f24232ec0cd79abe/scp.c#L989](https://github.com/openssh/openssh-portable/blob/a2855c048b3f4b17d8787bd3f24232ec0cd79abe/scp.c#L989 "https://github.com/openssh/openssh-portable/blob/a2855c048b3f4b17d8787bd3f24232ec0cd79abe/scp.c#L989")

## 问题复现

在openssh<=8.3p1的环境中：

下方命令在192.168.245.17执行touch /root/normal.sh，并将本地的a.txt复制到远程主机/root/b.txt

```纯文本
[root@host-a ~]# scp a.txt root@192.168.245.17:'`touch /root/normal.sh`/root/b.txt'
```

由于远程路径先执行了命令，再将a.txt复制到/root/b.txt,这种特殊的使用方法导致了异常结果。

## openssh供应商回应

scp命令是一种历史协议（称为rcp），它依赖于这种类型的参数传递，并遇到扩展问题。事实证明，很难在scp模型中添加“安全性”。所有“检测”和“防止”异常参数转移的尝试都非常有可能破坏现有工作流程。是的，我们认识到情况很糟糕。但我们不想打破人们使用scp的简单模式，直到有一个普通的替代品。如果人们担心的话，他们应该使用rsync或其他东西。

> 原文：
> The scp command is a historical protocol (called rcp) which relies upon that style of argument passing and encounters expansion problems. It has proven very difficult to add "security" to the scp model. All attempts to "detect" and "prevent" anomalous argument transfers stand a great chance of breaking existing workflows. Yes, we recognize it the situation sucks. But we don't want to break the easy patterns people use scp for, until there is a commonplace replacement. People should use rsync or something else instead if they are concerned.

## 解决方案

1.  需要将openssh升级到>8.3p1，但没有针对[Centos7.x的rpm](.net/linux/rpm2html/search.php "Centos7.x的rpm")包，因此需要升级操作系统。
2.  供应商：单文件远程复制时直接放弃scp，使用rsync。

## 个人理解

这种在特殊的使用方式下，是会造成异常结果。在系统管理员使用scp时稍加注意即可。另外，DB02的备份脚本并无掺杂执行命令的额外内容，是scp的常规用法也并不触发Bug。
