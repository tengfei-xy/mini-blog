# RHEL7.6é™é»˜å®‰è£…19c RAC

æ–‡æ¡£ä½¿ç”¨èµ„æºï¼š[ç™¾åº¦ç½‘ç›˜](https://pan.baidu.com/s/1KEb2QFoM4rlNHJOq1ljSTQ)ï¼Œæå–ç : cebv 

æ–‡æ¡£ä½œè€…å¾®ä¿¡ï¼šMelta_

æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š2021å¹´11æœˆ1æ—¥



# ä¸€ã€åŸºæœ¬ä¿¡æ¯

èŠ‚ç‚¹åŸºæœ¬ä¿¡æ¯ï¼š

|                   |                  èŠ‚ç‚¹ä¸€                   |                  èŠ‚ç‚¹äºŒ                   |
| :---------------: | :---------------------------------------: | :---------------------------------------: |
|      ä¸»æœºå       |             nb-yszl-app-db01              |             nb-yszl-app-db02              |
|     æ“ä½œç³»ç»Ÿ      |                 RedHat7.6                 |                 RedHat7.6                 |
|  gridç”¨æˆ·å/å¯†ç   |                   grid                    |                   grid                    |
| Oracleç”¨æˆ·å/å¯†ç  |                  oracle                   |                  oracle                   |
|    Oracle ç‰ˆæœ¬    | 19c Enterprise Edition Release 19.3.0.0.0 | 19c Enterprise Edition Release 19.3.0.0.0 |
|   oracleç”¨æˆ·SID   |                  oracle1                  |                  oracle2                  |
|    gridç”¨æˆ·SID    |                   +ASM1                   |                   +ASM2                   |
|    GIå®‰è£…ä½ç½®     |            /u01/app/grid/base             |            /u01/app/grid/base             |
|  æ•°æ®åº“å®‰è£…ä½ç½®   |              /u01/app/oracle              |              /u01/app/oracle              |
|      å…¬ç½‘IP       |              10.104.174.1/24              |              10.104.174.2/24              |
|      ç§ç½‘IP       |              192.168.0.1/24               |              192.168.0.2/24               |

å‡†å¤‡æ–‡ä»¶

æ³¨ï¼šzipè§£å‹è‡³èŠ‚ç‚¹ä¸€çš„$ORACHLE_HOME

```bash
LINUX.X64_193000_grid_home.zip
LINUX.X64_193000_db_home.zip
libaio-devel-0.3.109-13.el7.x86_64.rpm
compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm
```



# äºŒã€ç³»ç»Ÿè°ƒæ•´

## 1ã€ç½‘ç»œè®¾ç½®

- ä¿®æ”¹/etc/hostsï¼ˆæ³¨ï¼šå…·ä½“ipæ ¹æ®å®é™…æƒ…å†µå¡«å†™ï¼‰

  å‚è€ƒæ–‡æ¡£ï¼šRACçš„å‡ ç§IPï¼šhttps://cloud.tencent.com/developer/article/1578494
  
  ```bash
  # public
  10.104.174.1 nb-yszl-app-db01
  10.104.174.2 nb-yszl-app-db02
  
  # private
  192.168.0.1 nb-yszl-app-db01-priv
  192.168.0.2 nb-yszl-app-db02-priv
  
  # virtual
  10.104.174.7 nb-yszl-app-db01-vip
  10.104.174.8 nb-yszl-app-db02-vip
  
  # scan
  10.104.174.9 sy-plp-oracle-scan
  ```

## 2ã€ç”¨æˆ·/ç»„é…ç½®

- ç”¨æˆ·ç»„

  ```bash
  groupadd dba
  groupadd oinstall
  groupadd oper
  groupadd asmoper
  groupadd asmdba
  groupadd asmadmin
  groupadd backupdba
  groupadd dgdba
  groupadd kmdba
  ```

- girdç”¨æˆ·

  åˆ›å»ºç”¨æˆ·

  ```bash
  useradd -g oinstall -p `openssl passwd -1 "grid"` -G asmadmin,asmdba,asmoper,dba -d /home/grid -m grid
  ```

  ç¼–è¾‘/home/grid/.bash_profile

  ==æ³¨ï¼šèŠ‚ç‚¹ä¸€çš„ORACLE_SIDä¸º+ASM1ï¼ŒèŠ‚ç‚¹äºŒçš„ORACLE_SIDä¸º+ASM2==
  
  ```bash
  export ORACLE_BASE=/u01/app/grid/base
  export ORACLE_HOME=/u01/app/grid/home
  export ORACLE_SID=+ASM1
  export CRS_HOME=$ORACLE_HOME
  export OPATCH=$ORACLE_HOME/OPatch
  export PATH=$PATH:$ORACLE_HOME/bin:$OPATCH
  ```
  
- oracle ç”¨æˆ·

  åˆ›å»ºç”¨æˆ·

  ```bash
  useradd -g oinstall -p `openssl passwd -1 "oracle"` -G dba,asmdba,oper,kmdba,backupdba,dgdba -d /home/oracle -m oracle
  ```

  ç¼–è¾‘/home/oracle/.bash_profile

  ==æ³¨ï¼šèŠ‚ç‚¹ä¸€çš„ORACLE_SIDä¸ºoracle1ï¼ŒèŠ‚ç‚¹äºŒçš„ORACLE_SIDä¸ºoracle2==
  
  ```bash
  export ORACLE_BASE=/u01/app/oracle
  export ORACLE_HOME=/u01/app/oracle/product/19.3.0/db_1
  export OPATCH=$ORACLE_HOME/OPatch
  export ORACLE_SID=oracle1
  export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
  export PATH=$PATH:$ORACLE_HOME/bin:$OPATCH
  ```
  
- èµ‹æƒ

  ```bash
  mkdir -p /u01/app/oracle/product/19.3.0/db_1
  chown -R oracle:oinstall /u01
  mkdir -p /u01/app/grid/base /u01/app/grid/home
  chown -R grid:oinstall /u01/app/grid
  mkdir /u01/app/oraInventory
  chown grid:oinstall /u01/app/oraInventory && chmod 775 /u01/app/oraInventory
  ```


æ­¤æ—¶å¯ä»¥è§£å‹zipåˆ°å„è‡ªç”¨æˆ·çš„ORACLE_HOMEä¹‹ä¸‹

## 3ã€swapè®¾ç½®

1. åˆ›å»ºswapæ–‡ä»¶

   ```bash
   dd if=/dev/zero of=/rac-swap bs=1M count=16384
   ```

2. è®¾ç½®å¯è®¿é—®æƒé™

   ```bash
   chmod 600 /rac-swap
   ```

3. æ ¼å¼åŒ–æ–‡ä»¶

   ```bash
   mkswap /rac-swap
   ```

4. æ¿€æ´»swapç©ºé—´(æ¯æ¬¡swaponå¯ä»¥å åŠ swapç©ºé—´)

   ```bash
   swapon /rac-swap
   ```

5. å¼€æœºè‡ªåŠ¨å¯ç”¨swapç©ºé—´ï¼Œè¿½åŠ ä¸‹é¢å†…å®¹åˆ°/etc/fstab

   ```bash
   echo "/rac-swap swap swap default 0 0" >>/etc/fstab
   ```


## 4ã€ä¾èµ–

1. yum å®‰è£…

   ```bash
   yum -y -q install bc gcc gcc-c++  binutils  make gdb cmake  glibc ksh elfutils-libelf elfutils-libelf-devel fontconfig-devel glibc-devel libaio libXrender libXrender-devel libX11 libXau sysstat libXi libXtst libgcc librdmacm-devel libstdc++ libstdc++-devel libxcb net-tools nfs-utils compat-libcap1 smartmontools  targetcli python python-configshell python-rtslib python-six  unixODBC unixODBC-devel iscsi-initiator-utils unbound bind-utils kde-l10n-Chinese.noarch xclock lsof expect unzip redhat-lsb telnep ntsysv strace dos2unix ncurses-devel
   ```

2. å•ç‹¬å®‰è£…ä¾èµ–

   ```bash
   compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm
   libaio-devel-0.3.109-13.el7.x86_64.rpm
   ```

3. gridå‹ç¼©åŒ…ä¸­çš„ä¾èµ–å®‰è£…ï¼Œä½äºcv/rpm/ä¸‹

   ```bash
   cvuqdisk-1.0.10-1.rpm
   ```

## 5ã€å†…æ ¸å‚æ•°å’Œèµ„æºé™åˆ¶

1. è®¡ç®—shmallå’Œshmmax

   ```bash
   # kernel.shmall
   shmall=$(echo "`cat /proc/meminfo | grep "MemTotal" | awk '{print $2}'` / (`getconf PAGESIZE` / 1024)" | bc)
   
   # kernel.shmmax(å†…å­˜çš„80%)
   shmmax=$(echo "`cat /proc/meminfo | grep "MemTotal" | awk '{print $2}'` * 1024 * 0.8" | bc  | sed 's#\..*$##')
   ```

2. ä¿®æ”¹å‚æ•°

   ```bash
   cat >> /etc/sysctl.conf<<EOF
   fs.aio-max-nr = 3145728
   fs.file-max = 6815744
   kernel.shmall = ${shmall}
   kernel.shmmax = ${shmmax}
   kernel.shmmni = 4096
   kernel.sem = 250 32000 100 128
   net.ipv4.ip_local_port_range = 9000 65500
   net.core.rmem_default = 262144
   net.core.rmem_max = 4194304
   net.core.wmem_default = 262144
   net.core.wmem_max = 1048586
   vm.min_free_kbytes = 524288
   EOF
   ```

2. ç”Ÿæ•ˆå†…æ ¸å‚æ•°

   ```bash
   sysctl -p
   ```

4. èµ„æºé™åˆ¶ï¼šä¿®æ”¹/etc/security/limits.conf

   ```bash
   cat >> /etc/security/limits.conf<< EOF
   grid soft nproc 16384
   grid hard nproc 16384
   grid soft nofile 65536
   grid hard nofile 65536
   grid soft stack 10240
   grid hard stack 32768
   oracle soft nproc 16384
   oracle hard nproc 16384
   oracle soft nofile 65536
   oracle hard nofile 65536
   oracle soft stack 10240
   oracle hard stack 32768
   * soft memlock unlimited
   * hard memlock unlimited
   EOF
   ```


5. ä¿®æ”¹/etc/security/limits.d/20-nproc.conf

   ```bash
   sed -i -e "s/4096/16384/g" /etc/security/limits.d/20-nproc.conf
   echo "* hard nproc 16384" >> /etc/security/limits.d/20-nproc.conf
   ```


## 6ã€å…³é—­selinuxå’Œç¦ç”¨æœåŠ¡

```bash
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
setenforce 0
systemctl stop firewalld.service
systemctl disable firewalld
systemctl stop avahi-daemon
systemctl disable avahi-daemon
systemctl disable bluetooth
systemctl disable cpuspeed
systemctl disable cups
systemctl disable firstboot
systemctl disable ip6tables
systemctl disable iptables
systemctl disable pcmcia
systemctl enable rc-local
systemctl start rc-local
```

## 7ã€å…¶ä»–è®¾ç½®

1. å–æ¶ˆctl+alt+deleteé‡å¯

   ```bash
   rm -f /usr/lib/systemd/system/ctrl-alt-del.target
   ```

2. å…³é—­Transparent HugePages

   ```bash
   echo never > /sys/kernel/mm/transparent_hugepage/enabled
   echo never > /sys/kernel/mm/transparent_hugepage/defrag
   ```


3. è®¾ç½®RemoveIPCï¼Œç¼–è¾‘/etc/systemd/logind.conf

   ```bash
   RemoveIPC=no
   ```


4. é‡å¯æœåŠ¡

   ```bash
   systemctl daemon-reload
   systemctl restart systemd-logind
   ```


5. è®¾å®šæŒ‚è½½ï¼ˆå¦‚æœå­˜åœ¨/dev/shmçš„è¯ï¼‰

   ```bash
   echo "tmpfs /dev/shm tmpfs defaults 0 0" >> /etc/fstab
   ```


6. ç¦ç”¨è·¯ç”±

   ```bash
   cat>> /etc/sysconfig/network<<EOF
   NOZEROCONF=yes
   EOF
   ```


7. NTPç½‘ç»œæ—¶é—´æœåŠ¡å™¨

   æ³¨é‡Šcontab -lçš„ntpdate -s åŒæ­¥ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¯ä»¥è®¾ç½®ntpæœåŠ¡å™¨ã€‚

# ä¸‰ã€å…±äº«ç£ç›˜é…ç½®

é™¤é…ç½®iscsiæœåŠ¡ç«¯å¤–ï¼Œå…¶ä»–æ­¥éª¤**æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œ**

å‚è€ƒï¼š[iscsiå®‰è£…å‚è€ƒæ–‡æ¡£](https://blog.csdn.net/cuichongxin/article/details/103982207)

==æ³¨ï¼šé¦–å…ˆé…ç½®çš„asmè¡¨å†³ç›˜ä¸‰å—åº”è¯¥æ˜¯ç›¸åŒå¤§å°ã€‚==

## 1ã€é…ç½®iscsiæœåŠ¡ç«¯

1. å®‰è£…

   ```bash
   yum install -y target*
   ```

2. å¯åŠ¨å¹¶è‡ªå¯

   ```bash
   systemctl enable target
   systemctl start target
   ```

3. å°†æœªæ ¼å¼åŒ–ã€æœªåˆ†åŒºçš„ç¡¬ç›˜è¿›è¡Œåˆ†åŒºé€šè¿‡`fdisk -l`æ£€æŸ¥åˆ°`/dev/sdb`æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œå…±äº«çš„ç£ç›˜ï¼Œå…ˆå°†å®ƒåˆ†åŒº,ä½†ä¸éœ€è¦æ ¼å¼åŒ–

   ```bash
   [root@ora1 grid]# fdisk /dev/sdb
   å‘½ä»¤(è¾“å…¥ m è·å–å¸®åŠ©)ï¼šn
   Select (default p): p
   åˆ†åŒºå· (1-4ï¼Œé»˜è®¤ 1)ï¼š1
   èµ·å§‹ æ‰‡åŒº (2048-41943039ï¼Œé»˜è®¤ä¸º 2048)ï¼š2048
   Last æ‰‡åŒº, +æ‰‡åŒº or +size{K,M,G} (2048-41943039ï¼Œé»˜è®¤ä¸º 41943039)ï¼š13981696
   
   å‘½ä»¤(è¾“å…¥ m è·å–å¸®åŠ©)ï¼šn
   Select (default p): p
   åˆ†åŒºå· (2-4ï¼Œé»˜è®¤ 2)ï¼š2
   èµ·å§‹ æ‰‡åŒº (13981697-41943039ï¼Œé»˜è®¤ä¸º 13983744)ï¼š13983744
   Last æ‰‡åŒº, +æ‰‡åŒº or +size{K,M,G} (13983744-41943039ï¼Œé»˜è®¤ä¸º 41943039)ï¼š27962026
   
   å‘½ä»¤(è¾“å…¥ m è·å–å¸®åŠ©)ï¼šn
   Select (default p): p
   åˆ†åŒºå· (3,4ï¼Œé»˜è®¤ 3)ï¼š3
   èµ·å§‹ æ‰‡åŒº (13981697-41943039ï¼Œé»˜è®¤ä¸º 27963392)ï¼š27963392
   Last æ‰‡åŒº, +æ‰‡åŒº or +size{K,M,G} (27963392-41943039ï¼Œé»˜è®¤ä¸º 41943039)ï¼š41943039
   
   å‘½ä»¤(è¾“å…¥ m è·å–å¸®åŠ©)ï¼šw
   The partition table has been altered!
   Calling ioctl() to re-read partition table.
   æ­£åœ¨åŒæ­¥ç£ç›˜ã€‚
   ```

4. æŸ¥çœ‹åˆ†åŒº

   ```bash
   ora1 ~]# lsblk
   NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
   sda               8:0    0   50G  0 disk 
   â”œâ”€sda1            8:1    0    1G  0 part /boot
   â””â”€sda2            8:2    0   49G  0 part 
     â”œâ”€centos-root 253:0    0 45.1G  0 lvm  /
     â””â”€centos-swap 253:1    0  3.9G  0 lvm  [SWAP]
   sdb               8:16   0   20G  0 disk 
   â”œâ”€sdb1            8:17   0    6G  0 part 
   â”œâ”€sdb2            8:18   0    6G  0 part 
   â””â”€sdb3            8:19   0    8G  0 part 
   sr0              11:0    1  4.5G  0 rom  
   loop0             7:0    0  4.5G  1 loop /mnt/iso
   ```

5. è¿›å…¥å­ç³»ç»Ÿ

   ```bash
   [root@ora1 ~]# targetcli
   ```

6. æ·»åŠ ç¡¬ç›˜ä¿¡æ¯æ ¼å¼

   ```bash
   /> /backstores/block create DB1 /dev/sdb1
   /> /backstores/block create DB2 /dev/sdb2
   /> /backstores/block create DB3 /dev/sdb3
   /> /backstores/block create DB4 /dev/sdb4
   ```

7. åˆ›å»ºiscsiï¼Œæ ¼å¼ï¼š/iscsi create æ ¼å¼.å¹´ä»½-æœˆä»½.*.com.è‡ªå®šä¹‰åç§°

   ```bash
   /> /iscsi create iqn.2021-09.04.com.oracle
   ```
   
8. å…³è”blockå’Œtarget

   ```bash
   /> /iscsi/iqn.2021-09.04.com.oracle/tpg1/luns create /backstores/block/DB1
   /> /iscsi/iqn.2021-09.04.com.oracle/tpg1/luns create /backstores/block/DB2
   /> /iscsi/iqn.2021-09.04.com.oracle/tpg1/luns create /backstores/block/DB3
   /> /iscsi/iqn.2021-09.04.com.oracle/tpg1/luns create /backstores/block/DB4
   ```

9. åˆ›å»ºacl

   ```bash
   /> /iscsi/iqn.2021-09.04.com.oracle/tpg1/acls create iqn.2021-09.04.com.oracle:ora
   ```

10. é€€å‡º

    ```bash
    /> exit
    Global pref auto_save_on_exit=true
    Configuration saved to /etc/target/saveconfig.json
    ```

11. é‡å¯æœåŠ¡

    ```bash
    systemctl restart target
    ```

    æ³¨ï¼šæ­¤æ—¶ä¼šæœ‰ç«¯å£å¼€æ”¾

    ```bash
    [root@ora1 ~]# netstat -tunlp |grep 3260
    tcp        0      0 0.0.0.0:3260            0.0.0.0:*               LISTEN      - 
    ```

## 2ã€é…ç½®iscsiå®¢æˆ·ç«¯

1. å®‰è£…

   ```bash
   yum install -y iscsi*
   ```

2. å¼€æœºè‡ªå¯

   ```bash
   systemctl enable iscsid
   ```

3. å‘ç°target

   æ³¨ï¼šæœ‰è¾“å‡ºæ‰æ˜¯è¢«å‘ç°ï¼Œ-p åé¢çš„å‚æ•°æ˜¯iscsiæœåŠ¡ç«¯çš„ip

   ```bash
   [root@ora1 ~]# iscsiadm -m discovery -t st -p 10.104.174.1
   10.104.174.1:3260,1 iqn.2021-09.04.com.oracle
   ```

4. ä¿®æ”¹/etc/iscsi/initiatorname.iscsi

   ```bash
   InitiatorName=iqn.2021-09.04.com.oracle:ora
   ```

5. é‡å¯æœåŠ¡

   ```bash
   systemctl restart iscsid
   ```

6. ç™»å½•

   æ³¨ï¼šéœ€è¦å‘ç°åï¼Œæ‰èƒ½ç™»é™†

   ```bash
   iscsiadm -m node -T iqn.2021-09.04.com.oracle -p 10.104.174.1 -l
   ```

   å¦‚æœåœ¨ä¸»æœºAæ ¼å¼åŒ–äº†å…±äº«ç›˜ï¼Œåœ¨Bä¸Šå…¶å®æœ‰äº†ï¼Œä½†å¯èƒ½éœ€è¦é‡æ–°ç™»å½•åï¼Œæ‰èƒ½åœ¨`lsblk`ä¸­çœ‹è§ï¼Œä¸ç™»å½•ä¹Ÿå¯ä»¥ç›´æ¥ç”¨æ ¼å¼åŒ–çš„ç£ç›˜

7. æ£€æŸ¥,å…¶ä¸­sdc,sdd,sdeå°±æ˜¯æˆ‘ä»¬å…±äº«ç›˜å•¦

   ```bash
   [root@ora1 ~]# lsblk
   NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
   sda               8:0    0   50G  0 disk 
   â”œâ”€sda1            8:1    0    1G  0 part /boot
   â””â”€sda2            8:2    0   49G  0 part 
     â”œâ”€centos-root 253:0    0 45.1G  0 lvm  /
     â””â”€centos-swap 253:1    0  3.9G  0 lvm  [SWAP]
   sdb               8:16   0   50G  0 disk 
   â”œâ”€sdb1            8:17   0    8G  0 part 
   â”œâ”€sdb2            8:18   0    8G  0 part 
   â”œâ”€sdb3            8:19   0    8G  0 part 
   â””â”€sdb4            8:20   0   26G  0 part 
   sdc               8:32   0    8G  0 disk 
   â””â”€sdc1            8:33   0    8G  0 part 
   sdd               8:48   0    1K  0 disk 
   sde               8:64   0    8G  0 disk 
   sdf               8:80   0    8G  0 disk 
   sr0              11:0    1  4.5G  0 rom  
   loop0             7:0    0  4.5G  1 loop /mnt/iso
   ```

8. åœ¨èŠ‚ç‚¹ä¸€åˆ†åŒºï¼Œå¹¶åœ¨èŠ‚ç‚¹äºŒé‡æ–°ç™»å½•ï¼ˆå…¶å®åˆ†ä¸åˆ†åŒºæ— æ‰€è°“ğŸ˜…ï¼‰

   èŠ‚ç‚¹ä¸€ï¼š

   ```bash
   [root@ora1 ~]# fdisk /dev/sdc
   [root@ora1 ~]# fdisk /dev/sdd
   [root@ora1 ~]# fdisk /dev/sde
   [root@ora1 ~]# fdisk /dev/sdf
   ```
   
   èŠ‚ç‚¹äºŒï¼š
   
   ```bash
   # æ³¨é”€
   [root@ora2 ~]# iscsiadm -m node -T iqn.2021-09.04.com.oracle -p 10.104.174.1 -u
   Logging out of session [sid: 6, target: iqn.2021-09.04.com.oracle, portal: 10.104.174.1,3260]
   Logout of [sid: 6, target: iqn.2021-09.04.com.oracle, portal: 10.104.174.1,3260] successful.
   # é‡æ–°ç™»å½•
   [root@ora2 ~]# iscsiadm -m node -T iqn.2021-09.04.com.oracle -p 10.104.174.1 -l
   Logging in to [iface: default, target: iqn.2021-09.04.com.oracle, portal: 10.104.174.1,3260] (multiple)
   Login to [iface: default, target: iqn.2021-09.04.com.oracle, portal: 10.104.174.1,3260] successful.
   # å¯ä»¥çœ‹åˆ°ç£ç›˜è¢«åˆ†åŒºäº†
   [root@ora2 ~]# lsblk
   NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
   sda               8:0    0   50G  0 disk 
   â”œâ”€sda1            8:1    0    1G  0 part /boot
   â””â”€sda2            8:2    0   49G  0 part 
     â”œâ”€centos-root 253:0    0 45.1G  0 lvm  /
     â””â”€centos-swap 253:1    0  3.9G  0 lvm  [SWAP]
   sdb               8:16   0    8G  0 disk 
   â””â”€sdb1            8:17   0    8G  0 part 
   sdc               8:32   0   26G  0 disk 
   â””â”€sdc1            8:33   0   26G  0 part 
   sdd               8:48   0    8G  0 disk 
   â””â”€sdd1            8:49   0    8G  0 part 
   sde               8:64   0    8G  0 disk 
   â””â”€sde1            8:65   0    8G  0 part 
   sr0              11:0    1  4.5G  0 rom 
   ```

## 3ã€é…ç½®å¤šè·¯å¾„

å‚è€ƒæ–‡æ¡£ï¼š

[æ·±å…¥åˆ†æMultipath](https://www.huaweicloud.com/articles/14b07cc5cc28d2bc19d3b6330ed05f09.html)

[Oracle racæ­å»ºä½¿ç”¨Multipath](https://blog.csdn.net/cuiyan1982/article/details/79082805)

1. å®‰è£…è½¯ä»¶ï¼ˆå¦‚æœæ²¡æœ‰å®‰è£…ï¼‰

   ```bash
   yum install device-mapper* -y
   ```

2. å¯ç”¨æ¨¡å—

   ```bash
    modprobe dm-multipath
    modprobe dm-round-robin
   ```

3. æŸ¥çœ‹æ˜¯å¦å¯ç”¨

   ```bash
   [root@ora1 ~]# lsmod | grep ^dm_m[uo]
   dm_multipath           27792  1 dm_round_robin
   dm_mod                124501  9 dm_multipath,dm_log,dm_mirror
   ```

4. ç”ŸæˆMultipathè€Œé…ç½®æ–‡ä»¶

   ```bash
    mpathconf --enable --find_multipaths y --with_module y --with_multipathd y
   ```

5. æ·»åŠ å…±äº«ç£ç›˜çš„wwid

   ```bash
   # å°†æ·»åŠ åˆ°/etc/multipath/wwid
   [root@ora1 ~]# multipath -a /dev/sdc
   wwid '36001405845f59a2eb5e43b6b20604d27' added
   [root@ora1 ~]# multipath -a /dev/sdd
   wwid '36001405b381f6cd51044a1b89aab5fbe' added
   [root@ora1 ~]# multipath -a /dev/sde
   wwid '36001405146055fb6230434b9ec999dc7' added
   [root@ora1 ~]# multipath -a /dev/sdf
   wwid '360014059099bfbbcb9349b081de121e8' added
   ```

6. ä¿®æ”¹/etc/multipath.confé…ç½®æ–‡ä»¶

   [å¤šè·¯å¾„é…ç½®æ–‡ä»¶è¯¦è§£](https://www.cnblogs.com/azyb/p/10809490.html)

   ==æ³¨ï¼šå°†æœ¬åœ°ç£ç›˜æ’é™¤,æ³¨æ„å¦‚æœç›´æ¥å¤åˆ¶æ–‡ä»¶åˆ°å¦ä¸€èŠ‚ç‚¹æ³¨æ„è¢«æ’é™¤çš„ç¡¬ç›˜==

   ```bash
   defaults {
           user_friendly_names yes
           find_multipaths yes
           path_grouping_policy multibus
           path_selector "round-robin 0"
           failback manual
           rr_weight priorities
           no_path_retry 5
   }
   blacklist {
          devnode "sr0"
   }
   multipaths {
          multipath {
                 wwid 36001405845f59a2eb5e43b6b20604d27
                 alias RAC-OCRVOTE1
          }
          multipath {
                 wwid 36001405146055fb6230434b9ec999dc7
                 alias RAC-OCRVOTE2
          }
          multipath {
                 wwid 360014059099bfbbcb9349b081de121e8
                 alias RAC-OCRVOTE3
          }
          multipath {
                 wwid 36001405b381f6cd51044a1b89aab5fbe
                 alias RAC-DATA
          }
   }
   ```
   
7. é‡å¯æœåŠ¡

   ```bash
   systemctl restart multipathd
   ```

8. æ£€æŸ¥

   æ­¤æ—¶æŸ¥çœ‹`multipath -v3 | grep "not in wwids file, skipping" `ï¼Œæ²¡æœ‰æŠ¥é”™ã€‚

   æŸ¥çœ‹

   ```bash
   [root@ora1 ~]# ll /dev/mapper/RAC-*
   lrwxrwxrwx. 1 root root 7 Oct 21 02:59 /dev/mapper/RAC-DATA -> ../dm-8
   lrwxrwxrwx. 1 root root 8 Oct 21 02:59 /dev/mapper/RAC-DATA1 -> ../dm-10
   lrwxrwxrwx. 1 root root 7 Oct 21 02:59 /dev/mapper/RAC-OCRVOTE1 -> ../dm-7
   lrwxrwxrwx. 1 root root 7 Oct 21 02:59 /dev/mapper/RAC-OCRVOTE1p1 -> ../dm-9
   lrwxrwxrwx. 1 root root 7 Oct 21 02:59 /dev/mapper/RAC-OCRVOTE2 -> ../dm-4
   lrwxrwxrwx. 1 root root 7 Oct 21 02:59 /dev/mapper/RAC-OCRVOTE2p1 -> ../dm-6
   lrwxrwxrwx. 1 root root 7 Oct 21 02:59 /dev/mapper/RAC-OCRVOTE3 -> ../dm-3
   lrwxrwxrwx. 1 root root 7 Oct 21 02:59 /dev/mapper/RAC-OCRVOTE3p1 -> ../dm-5
   ```
   
   æŸ¥çœ‹
   
   ```bash
   [root@ora1 ~]# multipathd show paths
   hcil    dev dev_t pri dm_st  chk_st dev_st  next_check     
   4:0:0:0 sdc 8:32  1   active ready  running XXXXXXX... 15/20
   4:0:0:1 sdf 8:80  1   active ready  running XXXXXXX... 15/20
   4:0:0:2 sde 8:64  1   active ready  running XXXXXXX... 15/20
   4:0:0:3 sdd 8:48  1   active ready  running XXXXXXX... 15/20
   ```
   
   åˆ°æ­¤multipath é…ç½®å®Œæˆï¼

## 4ã€é…ç½®udev

å‚è€ƒæ–‡æ¡£ï¼š[udevç®€ä»‹åŠé…ç½®](http://blog.itpub.net/25469263/viewspace-2156439/)

é€šè¿‡UDEVé…ç½®ï¼Œèƒ½å¤Ÿè®©Oracleå¯¹ç£ç›˜åè¿›è¡ŒæŒä¹…åŒ–å¹¶æ”¹å˜ç£ç›˜è®¿é—®æƒé™ä¸ºgrid:asmadminã€‚è¿™æ ·åœ¨ASMçš„é…ç½®è¿‡ç¨‹ä¸­èƒ½å¤Ÿçœ‹åˆ°ç£ç›˜ã€‚ä»Šåå¢åŠ ç£ç›˜ä¹Ÿä¸ä¼šæ”¹å˜åŸæœ‰çš„ç£ç›˜åç§°ã€‚è¯¥æ­¥éª¤å¯ä½¿ç”¨ASMLIB

1. æ‰¹é‡ç”Ÿæˆé…ç½®æ–‡ä»¶å¹¶æ·»åŠ åˆ°/etc/udev/rules.d/99-oracle-asmdevices.rules

   æ¨¡æ¿ï¼š

   ```bash
   # KERNEL=="dm-*",SYMLINK+="",ENV{DM_UUID}=="",OWNER="grid",GROUP="asmadmin",MODE="0660" ENV{DM_UUID}==""ä¾æ¬¡ä¸ºä¸Šè¯‰æŸ¥æ‰¾çš„ç»“æœï¼ŒSYMLINKï¼ˆè¯¥åç§°ä½œä¸º/dev/.....ï¼‰
   ```
   
   å…·ä½“å‘½ä»¤ï¼š
   
   ```bash
   for i in RAC-DATA RAC-OCRVOTE1 RAC-OCRVOTE2 RAC-OCRVOTE3; do
   printf "KERNEL==\"dm-*\",SYMLINK+=\"%s\",ENV{DM_UUID}==\"%s\",OWNER=\"grid\",GROUP=\"asmadmin\",MODE=\"0660\" \n" "$i" "$(udevadm info --query=all --name=/dev/mapper/$i |grep -i -o dm_uuid.*)"; 
   done | sed 's\"DM_UUID=\"\g' >/etc/udev/rules.d/99-oracle-asmdevices.rules
   ```
   
   ä»¥ä¸‹ä¸ºä¸Šè¿°å‘½ä»¤çš„è¾“å‡º
   
   ```
   KERNEL=="dm-*",SYMLINK+="RAC-DATA",ENV{DM_UUID}=="mpath-36001405b381f6cd51044a1b89aab5fbe",OWNER="grid",GROUP="asmadmin",MODE="0660" 
   KERNEL=="dm-*",SYMLINK+="RAC-OCRVOTE1",ENV{DM_UUID}=="mpath-36001405845f59a2eb5e43b6b20604d27",OWNER="grid",GROUP="asmadmin",MODE="0660" 
   KERNEL=="dm-*",SYMLINK+="RAC-OCRVOTE2",ENV{DM_UUID}=="mpath-36001405146055fb6230434b9ec999dc7",OWNER="grid",GROUP="asmadmin",MODE="0660" 
   KERNEL=="dm-*",SYMLINK+="RAC-OCRVOTE3",ENV{DM_UUID}=="mpath-360014059099bfbbcb9349b081de121e8",OWNER="grid",GROUP="asmadmin",MODE="0660" 
   ```
   
2. åŒèŠ‚ç‚¹é…ç½®å®Œå®Œè§„åˆ™å,é‡å¯udevæœåŠ¡

   ```bash
   udevadm control --reload-rules
   udevadm trigger --type=devices --action=change
   ```

3. æµ‹è¯•æ–‡ä»¶æ˜¯å¦ç”Ÿæ•ˆ

   åœ¨æŸ¥çœ‹`ll /dev/mapper/`æ—¶ï¼Œèƒ½å¤Ÿå‘ç°`RAC-FRA1 -> ../dm-5`ï¼Œ`RAC-OCRVOTE1 -> ../dm-6`ï¼Œ`RAC-DATA1 -> ../dm-7`ï¼Œé’ˆå¯¹dm-5ã€dm-6ã€dm-7è¿›è¡ŒæŸ¥çœ‹ã€‚

   ```bash
   udevadm test /sys/block/dm-5
   ```

   æŸ¥çœ‹æƒé™åˆ†é…æ˜¯å¦æ­£ç¡®

   ```bash
   [root@ora1 rules.d]# ll /dev/dm-5
   brw-rw---- 1 grid asmadmin 253, 5 7æœˆ   4 14:06 /dev/dm-5
   ```



# å››ã€å®‰è£…Grid Infrastructure

1. äº’ä¿¡ï¼šåœ¨gridçš„å®‰è£…åŒ…ä¸‹ï¼Œä½¿ç”¨gridç”¨æˆ·æ‰§è¡Œ

   ```bash
   ./oui/prov/resources/scripts/sshUserSetup.sh -hosts "ora1 ora2" -user grid -advanced -noPromptPassphrase
   ```


2. rspèµ„æºæ–‡ä»¶

   ```bash
   # ä¸è¦æ›´æ”¹
   oracle.install.responseFileVersion=/oracle/install/rspfmt_crsinstall_response_schema_v19.0.0
   INVENTORY_LOCATION=/u01/app/oraInventory
   oracle.install.option=CRS_CONFIG
   # gridçš„$ORACLE_BASE
   ORACLE_BASE=/u01/app/grid/base
   oracle.install.asm.OSDBA=asmdba
   oracle.install.asm.OSOPER=asmoper
   oracle.install.asm.OSASM=asmadmin
   oracle.install.crs.config.scanType=LOCAL_SCAN
   oracle.install.crs.config.SCANClientDataFile=
   # scan name
   oracle.install.crs.config.gpnp.scanName=ora-scan
   oracle.install.crs.config.gpnp.scanPort=1521
   oracle.install.crs.config.ClusterConfiguration=STANDALONE
   oracle.install.crs.config.configureAsExtendedCluster=false
   oracle.install.crs.config.memberClusterManifestFile=
   # é›†ç¾¤åå¯ä»¥é»˜è®¤
   oracle.install.crs.config.clusterName=ora-cluster
   oracle.install.crs.config.gpnp.configureGNS=false
   oracle.install.crs.config.autoConfigureClusterNodeVIP=false
   oracle.install.crs.config.gpnp.gnsOption=
   oracle.install.crs.config.gpnp.gnsClientDataFile=
   oracle.install.crs.config.gpnp.gnsSubDomain=
   oracle.install.crs.config.gpnp.gnsVIPAddress=
   oracle.install.crs.config.sites=
   # ä¸»æœºå
   oracle.install.crs.config.clusterNodes=ora1:ora1-vip,ora2:ora2-vip
   # 1:public,5:ASM&private,3:not use
   oracle.install.crs.config.networkInterfaceList=ens33:192.168.1.0:1,ens37:192.168.245.0:5
   oracle.install.crs.configureGIMR=false
   oracle.install.asm.configureGIMRDataDG=false
   oracle.install.crs.config.storageOption=FLEX_ASM_STORAGE
   oracle.install.crs.config.sharedFileSystemStorage.votingDiskLocations=
   oracle.install.crs.config.sharedFileSystemStorage.ocrLocations=               	
   oracle.install.crs.config.useIPMI=false
   oracle.install.crs.config.ipmi.bmcUsername=
   oracle.install.crs.config.ipmi.bmcPassword=
   oracle.install.asm.SYSASMPassword=Password@1
   # ä»…ç”¨äºOCRï¼ˆDATAç›˜åç»­æ·»åŠ ï¼‰
   oracle.install.asm.diskGroup.name=OCR
   oracle.install.asm.diskGroup.redundancy=NORMAL
   oracle.install.asm.diskGroup.AUSize=4
   oracle.install.asm.diskGroup.FailureGroups=
   # OCRç£ç›˜ç»„
   oracle.install.asm.diskGroup.disksWithFailureGroupNames=/dev/RAC-OCRVOTE1,,/dev/RAC-OCRVOTE2,,/dev/RAC-OCRVOTE3,
   # æŒ‡å®šOCRç£ç›˜ç»„
   oracle.install.asm.diskGroup.disks=/dev/RAC-OCRVOTE1,/dev/RAC-OCRVOTE2,/dev/RAC-OCRVOTE3
   oracle.install.asm.diskGroup.quorumFailureGroupNames=
   # ç£ç›˜ç»„å‘ç°
   oracle.install.asm.diskGroup.diskDiscoveryString=/dev/RAC-*
   oracle.install.asm.monitorPassword=Password@1
   oracle.install.asm.gimrDG.name=
   oracle.install.asm.gimrDG.redundancy=
   oracle.install.asm.gimrDG.AUSize=1
   oracle.install.asm.gimrDG.FailureGroups=
   oracle.install.asm.gimrDG.disksWithFailureGroupNames=
   oracle.install.asm.gimrDG.disks=
   oracle.install.asm.gimrDG.quorumFailureGroupNames=
   oracle.install.asm.configureAFD=false
   oracle.install.crs.configureRHPS=false
   oracle.install.crs.config.ignoreDownNodes=false               	
   oracle.install.config.managementOption=NONE
   oracle.install.config.omsHost=
   oracle.install.config.omsPort=0
   oracle.install.config.emAdminUser=
   oracle.install.config.emAdminPassword=
   oracle.install.crs.rootconfig.executeRootScript=false
   oracle.install.crs.rootconfig.configMethod=
   oracle.install.crs.rootconfig.sudoPath=
   oracle.install.crs.rootconfig.sudoUserName=
   oracle.install.crs.config.batchinfo=
   oracle.install.crs.app.applicationAddress=
   oracle.install.crs.deleteNode.nodes=
   ```

3. æ£€ç´¢å®‰è£…ç¯å¢ƒ

   > ä¸€äº›CVUæ£€æŸ¥éœ€è¦æ ¹ç‰¹æƒæ‰èƒ½ä»ç³»ç»Ÿä¸­æ£€ç´¢æ‰€éœ€çš„ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ ¹å‡­æ®ä¸å¯ç”¨æ—¶ï¼Œç”¨æˆ·ä¼šæ”¶åˆ°â€œPRVG-11250â€ç­‰æ¶ˆæ¯çš„é€šçŸ¥ï¼šæ£€æŸ¥â€œRPMè½¯ä»¶åŒ…ç®¡ç†å™¨æ•°æ®åº“â€æ²¡æœ‰æ‰§è¡Œï¼Œå› ä¸ºå®ƒéœ€è¦â€œæ ¹â€ç”¨æˆ·ç‰¹æƒã€‚[MOSæ–‡æ¡£](https://support.oracle.com/knowledge/Oracle%20Database%20Products/2548970_1.html)

   ```bash
   ./runcluvfy.sh stage -pre crsinst -n ora1,ora2 -method root
   ```


4. å®‰è£…éªŒè¯ï¼Œæ ¹æ®æ—¥å¿—è¿‡æ»¤`VERIFICATION_FAILED`

   ```bash
    ./gridSetup.sh  -silent -responseFile ./install.rsp -executePrereqs
   ```

> å®‰è£…å‰çš„æ³¨æ„äº‹é¡¹ï¼š
>
> 1. å®‰è£…ä¹‹å‰è¯·ç¡®ä¿å…¶ä»–èŠ‚ç‚¹çš„$ORACLE_HOMEæ²¡æœ‰æ–‡ä»¶
>
> 2. å®‰è£…åŒ…åˆ«æ”¾åˆ°/tmpä¹‹ä¸‹ï¼Œå»ºè®®æ”¾åˆ°$ORACLE_HOME
> 3. ç½‘å¡ ç§æœ‰ç½‘å¡åº”è¯¥æ˜¯privateå’Œasm
> 4. è„šæœ¬æ‰§è¡Œé¡ºåºä¸ºåœ¨èŠ‚ç‚¹ä¸€ã€äºŒorainstRoot.shã€å†èŠ‚ç‚¹ä¸€ã€äºŒæ‰§è¡Œè„šæœ¬root.sh
> 5. ä»…åœ¨ç¡®å®šæ£€æµ‹çš„æ—¥å¿—æ— ä¸¥é‡é”™è¯¯æ—¶æ‰èƒ½ä½¿ç”¨`-ignorePrereqFailure`å‚æ•°

5. ä½¿ç”¨gridç”¨æˆ·ï¼Œè¿›å…¥å®¶ç›®å½•åå¼€å§‹å®‰è£…

   ```bash
   rm -rf /u01/app/oraInventory/* &&  ./gridSetup.sh -silent -responsefile ./install.rsp -ignoreInternalDriverError -ignorePrereqFailure
   ```


6. HAIPï¼šå¦‚æœä½¿ç”¨äº‘æœåŠ¡å™¨æ­å»ºï¼Œæœ€å¥½å…³é—­HAIPï¼Œå¦åˆ™ä¼šé€ æˆæ— æ³•è¿æ¥èŠ‚ç‚¹çš„169.254åœ°å€ï¼Œå…¶ä»–èŠ‚ç‚¹çš„+ASMå®ä¾‹æ— æ³•å¯åŠ¨

   ```bash
   export HAIP_UNSUPPORTED=YES
   ```

7. root.sh å’ŒoraInst.shæ‰§è¡Œé¡ºåºï¼š

   ```bash
   Execute /u01/app/oraInventory/orainstRoot.sh on the following nodes: 
   [ora1, ora2]
   Execute /u01/app/grid/home/root.sh on the following nodes: 
   [ora1, ora2]
   ```

8. æ£€æŸ¥å®ä¾‹çŠ¶æ€ï¼šä»»ä½•gridç”¨æˆ·æ‰§è¡Œ`lsnrctl staatus`å‡æœ‰å®ä¾‹å¯åŠ¨

   ```bash
   Services Summary...
   Service "+ASM" has 1 instance(s).
     Instance "+ASM2", status READY, has 1 handler(s) for this service...
   Service "+ASM_OCR" has 1 instance(s).
     Instance "+ASM2", status READY, has 1 handler(s) for this service...
   The command completed successfully
   ```

9. å®‰è£…å®Œæˆåä½¿ç”¨gridç”¨æˆ·æ‰§è¡Œï¼Œå¯èƒ½ä¼šæœ‰Configuration failedï¼Œå…³ç³»ä¸å¤§

   ```bash
   /u01/app/grid/home/gridSetup.sh -executeConfigTools -responseFile ./install.rsp -silent
   ```

   

# äº”ã€å®‰è£…oracleè½¯ä»¶

1. oracleç”¨æˆ·äº’ä¿¡

   ```bash
   ./oui/prov/resources/scripts/sshUserSetup.sh -hosts "ora1 ora2" -user oracle -advanced -noPromptPassphrase
   ```


2. rspèµ„æºæ–‡ä»¶

   ```ini
   oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v19.0.0
   oracle.install.option=INSTALL_DB_SWONLY
   UNIX_GROUP_NAME=oinstall
   INVENTORY_LOCATION=/u01/app/oraInventory
   # oracleçš„ç”¨æˆ·$ORACLE_HOME
   ORACLE_HOME=/u01/app/oracle/product/19.3.0/db_1
   # oracleçš„ç”¨æˆ·$ORACLE_BASE
   ORACLE_BASE=/u01/app/oracle
   oracle.install.db.InstallEdition=EE
   oracle.install.db.OSDBA_GROUP=dba
   oracle.install.db.OSOPER_GROUP=oper
   oracle.install.db.OSBACKUPDBA_GROUP=backupdba
   oracle.install.db.OSDGDBA_GROUP=dgdba
   oracle.install.db.OSKMDBA_GROUP=kmdba
   oracle.install.db.OSRACDBA_GROUP=dba
   oracle.install.db.rootconfig.executeRootScript=false
   oracle.install.db.rootconfig.configMethod=
   oracle.install.db.rootconfig.sudoPath=
   oracle.install.db.rootconfig.sudoUserName=
   # èŠ‚ç‚¹ä¸»æœºå
   oracle.install.db.CLUSTER_NODES=ora1,ora2
   oracle.install.db.config.starterdb.type=
   oracle.install.db.config.starterdb.globalDBName=
   oracle.install.db.config.starterdb.SID=
   oracle.install.db.ConfigureAsContainerDB=
   oracle.install.db.config.PDBName=
   oracle.install.db.config.starterdb.characterSet=
   oracle.install.db.config.starterdb.memoryOption=
   oracle.install.db.config.starterdb.memoryLimit=
   oracle.install.db.config.starterdb.installExampleSchemas=
   oracle.install.db.config.starterdb.password.ALL=
   oracle.install.db.config.starterdb.password.SYS=
   oracle.install.db.config.starterdb.password.SYSTEM=
   oracle.install.db.config.starterdb.password.DBSNMP=
   oracle.install.db.config.starterdb.password.PDBADMIN=
   oracle.install.db.config.starterdb.managementOption=
   oracle.install.db.config.starterdb.omsHost=
   oracle.install.db.config.starterdb.omsPort=
   oracle.install.db.config.starterdb.emAdminUser=
   oracle.install.db.config.starterdb.emAdminPassword=
   oracle.install.db.config.starterdb.enableRecovery=
   oracle.install.db.config.starterdb.storageType=
   oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=
   oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=
   oracle.install.db.config.asm.diskGroup=
   oracle.install.db.config.asm.ASMSNMPPassword=
   ```

3. æ‰§è¡Œå®‰è£…éªŒè¯

   ```bash
   ./runInstaller  -executePrereqs -silent -responsefile ./ora.rsp
   ```

   ==æ³¨ï¼š å…¶ä»–èŠ‚ç‚¹éœ€è¦æ¸…ç©º$ORACLE_HOME==

4. æ‰§è¡Œå®‰è£…

   ```bash
   ./runInstaller  -silent -ignorePrereqFailure -responsefile ./ora.rsp
   ```


5. æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œroot.sh

   ```bash
   As a root user, execute the following script(s):
   	1. /u01/app/oracle/product/19.3.0/db_1/root.sh
   
   Execute /u01/app/oracle/product/19.3.0/db_1/root.sh on the following nodes: 
   [ora1, ora2]
   ```




# å…­ã€åˆ›å»ºç£ç›˜ç»„

1. ä½¿ç”¨gridç”¨æˆ·åˆ›å»ºDATAç£ç›˜ç»„

   ```bash
   [grid@ora1 ~]$ asmca -silent \
   -sysAsmPassword Password@1 \
   -asmsnmpPassword Password@1 \
   -createDiskGroup -diskGroupName DATA \
   -disk /dev/RAC-DATA \
   -redundancy EXTERNAL -au_size 4 -compatible.asm 19.0.0.0.0 -compatible.rdbms 19.0.0.0.0
   
   [INFO] [DBT-30001] Disk groups created successfully. Check /u01/app/grid/base/cfgtoollogs/asmca/asmca-210904AM042040.log for details.
   ```
   



# ä¸ƒã€åˆ›å»ºæ•°æ®åº“å®ä¾‹

1. è¿›å…¥oracleç”¨æˆ·çš„$ORACLE_HOMEç›®å½•

   ```
   cd $ORACLE_HOME
   ```

2. dbca.rspèµ„æºæ–‡ä»¶(èŠ‚ç‚¹1çš„$ORACLE_SIDä¸ºoracle1ï¼ŒèŠ‚ç‚¹1çš„$ORACLE_SIDä¸ºoracle2)

   ```ini
   responseFileVersion=/oracle/assistants/rspfmt_dbca_response_schema_v12.2.0
   # gdb
   gdbName=oracle
   # SID
   sid=oracle
   databaseConfigType=RAC
   RACOneNodeServiceName=
   policyManaged=false
   createServerPool=false
   serverPoolName=
   cardinality=
   force=false
   pqPoolName=
   pqCardinality=
   # åˆ›å»ºä¸ºå®¹å™¨æ•°æ®åº“ï¼Œfalse,true
   createAsContainerDatabase=false
   # pdbæ•°é‡
   numberOfPDBs=0
   # pdbå,é»˜è®¤ç©º
   pdbName=
   # PDBä½¿ç”¨é‡åšæ—¥å¿—,false,true
   useLocalUndoForPDBs=false
   # pdbå¯†ç 
   pdbAdminPassword=
   # èŠ‚ç‚¹ä¸»æœºå
   nodelist=ora1,ora2
   # Data_Warehouse.dbc  General_Purpose.dbc  New_Database.dbt
   # /u01/app/oracle/product/19.3.0/db_1/assistants/dbca/templates/
   templateName=General_Purpose.dbc
   # syså¯†ç 
   sysPassword=Password@1
   # syspasså¯†ç 
   systemPassword=Password@1
   serviceUserPassword=
   emConfiguration=
   emExpressPort=5500
   runCVUChecks=FALSE
   dbsnmpPassword=
   omsHost=
   omsPort=0
   emUser=
   emPassword=
   dvConfiguration=false
   dvUserName=
   dvUserPassword=
   dvAccountManagerName=
   dvAccountManagerPassword=
   olsConfiguration=false
   datafileJarLocation=
   datafileDestination=+DATA/{DB_UNIQUE_NAME}/
   recoveryAreaDestination=
   storageType=ASM
   diskGroupName=+DATA/{DB_UNIQUE_NAME}/
   asmsnmpPassword=
   recoveryGroupName=
   # å­—ç¬¦é›†
   characterSet=AL32UTF8
   # å›½å®¶å­—ç¬¦é›†
   nationalCharacterSet=AL16UTF16
   registerWithDirService=false
   dirServiceUserName=
   dirServicePassword=
   walletPassword=
   listeners=LISTENER
   variablesFile=
   variables=
   initParams=
   sampleSchema=false
   memoryPercentage=40
   databaseType=MULTIPURPOSE
   automaticMemoryManagement=false
   totalMemory=0
   ```

3. å®‰è£…å‰æ£€æŸ¥

   ==æ³¨ï¼šå¦‚æœæœ‰é”™è¯¯ï¼Œå¯ä»¥ä»List of failed Taskså¼€å§‹çœ‹==

   ```
   dbca -silent -responsefile `pwd`/assistants/dbca/dbca.rsp -executePrereqs -databaseConfigType RAC
   ```


3. æ‰§è¡Œå®‰è£…

   ```
   dbca -silent -responsefile `pwd`/assistants/dbca/dbca.rsp  -createDatabase -ignorePrereqFailure
   ```






åˆ°æ­¤å®‰è£…å®Œæ¯•ï¼Œoracleç”¨æˆ·é€šè¿‡`sqlplus`å°è¯•è¿æ¥å®ä¾‹ï¼Œgridç”¨æˆ·é€šè¿‡`crs status res -t`æ£€æŸ¥çŠ¶æ€

